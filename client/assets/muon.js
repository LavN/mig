!function(){function __serializeObject__(a){var b=[];for(var c in a)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")}function __getAllViewEls__(){var a=[];for(var b in __views__)a.push(__views__[b].el);return a}function __mDeepExtend__(a,b){for(var c in b)b[c]instanceof Function?a[c]=b[c]:b[c]instanceof Array?a[c]=b[c].slice():b[c]instanceof Object?(a[c]=Object.create(b[c]),__mDeepExtend__(a[c],b[c])):a[c]=b[c]}function __getUniq__(){return Math.floor(9*Math.random()*Math.pow(10,9)+Math.pow(10,9))}function MuonPlugin(a){__mDeepExtend__(this,__MuonBase__),this.name=a}function MuonPackage(a){__mDeepExtend__(this,__MuonPackBase__),this.name=a}function __registerPlugin__(a){if(a in __plugins__)return __plugins__[a];var b=a.split(":"),c=m,d="";for(var e in b){var f=b[e];f in c.plugins?c=c.plugins[f]:(d+=d?d+":":""+f,c.plugins[f]=new m.MuonPlugin(d),c=c.plugins[f])}return __plugins__[a]=c,c}function bindSurrogate(a,b){return"string"==typeof a&&(a=b[a]),a?_.bind(a,b):void 0}function __flattenMiddleware__(a,b){return _.flatten([a]).filter(function(a){return"function"==typeof a}).map(function(a){return _.bind(a,b)})}function addPackRoutes(a,b,c){var d=function(a){return __flattenMiddleware__(a,c.surrogate)};if(c.middleware=d(c.middleware),m.packages[a].parentPack&&m.packages[a].parentPack.middleware&&(c.middleware=d(c.middleware.concat(m.packages[a].parentPack.middleware))),m.packages[a].middleware=c.middleware,_.isObject(c.routes)&&!c.routes.length){var e=_.keys(c.routes);for(var f in e.reverse())addRoute(a,b,e[f],bindSurrogate(c.routes[e[f]],c.surrogate),c.middleware)}else if(_.isArray(c.routes))for(var f in c.routes.reverse()){var g=c.routes[f];if(_.isString(g.package)){if(!_.isString(g.route))throw Error("No route specified for dependency '"+g.package+"' in package "+a);var h=prepareRoute(b,g.route);g.package=(m.packages[a].m.name?m.packages[a].m.name+":":"")+g.package,m.router.route(h,g.package,m.requirePack(g.package,null,a))}else{var i=d(c.middleware.concat(g.middleware));if(_.isString(g.redirect))addRedirect(a,b,g.route,g.redirect);else if((_.isString(g.route)||_.isRegExp(g.route))&&addRoute(a,b,g.route,bindSurrogate(g.callback,c.surrogate),i,g.page),_.isObject(g.routes)){var e=_.keys(g.routes);for(var j in e.reverse()){var k=bindSurrogate(g.routes[e[j]],c.surrogate);addRoute(a,b,e[j],k,i,g.page)}}}}}function runRouterMiddleware(a,b){var c=this;if(0==a.length)return b();try{$.when(a.shift().call(c)).then(_.partial(runRouterMiddleware.bind(c),a,b),m.router.back)}catch(d){console.log(d.message),m.router.back()}}function prepareRoute(a){_.isArray(a)||(a=[].slice.call(arguments));for(var b="";a.length;){var c=a.shift();c=c instanceof RegExp?c:toRegExp(c.replace(/^\//,"")),c=c.toString().replace(/(^\/\^)|(\$\/$)/g,""),b+=(b?"/":"")+c}return RegExp("^"+b+"$")}function addRoute(a,b,c,d,e,f){if(""===c&&m.router.route(prepareRoute(b),a+"_"+c+"_redirect",function(){m.router.navigate(m.router.path()+"/",{trigger:!0,replace:!0})}),!_.isString(f)){var g=toRegExp(c).toString().replace(/(^\/\^)|(\$\/$)/g,"");g=g.substr(0,-1==g.indexOf("(")?g.length:g.indexOf("(")),g=g.replace(/(^\/)|(\/$)/g,""),f=g.split("/").reverse().join("_"),0==f.length&&(f="index")}var h=m.packages[a].packageObject.surrogate;m.router.route(prepareRoute(b,c),a+"_"+c,function(){var b=arguments,c=f,g=m.packages[a].appView;h.currentPage=void 0;try{h.currentPage=g.get(c+(/_page$/.test(c)?"":"_page"))}catch(i){}runRouterMiddleware.call(h,e.slice(),function(){d&&d.apply(h,b);do{try{g.show(c)}catch(a){console.log(a.stack);break}c=g.parentAppPage}while(g=g.parentAppView)})})}function addRedirect(a,b,c,d){function e(){m.router.navigate(d,{trigger:!0,replace:!0})}""===c&&m.router.route(prepareRoute(b),a+"_"+c+"_redirect",function(){m.router.navigate(m.router.path()+"/",{trigger:!0,replace:!0})}),m.router.route(prepareRoute(b,c),a+"_"+c,e)}function __procUnhandledViews__(a){var b=[];$("script[data-pack='"+a+"'][type='text/muon-template']").each(function(){if(-1==b.indexOf(this)){b.push(this),$("script#"+this.id+"[data-pack='"+a+"'][type='text/muon-template']").not(this).each(function(){b.push(this)});var c=this.id.replace(/_template$/,""),d=c.match(/_([a-zA-Z0-9]*?)$/)[1];if(c=c.replace(RegExp("_"+d+"$"),""),!m.packages[a].views[d]||!m.packages[a].views[d][c]){var e=null;"application"==c&&"stack"==d?e=m.ApplicationStackView:c.match(/_page$/)&&"layout"==d?e=m.PageLayoutView:d in m.baseViews&&(e=m.baseViews[d]),e&&e.extend({template:c,"package":a})}}})}function __procProfiledViews__(a){$("script[data-pack='"+a+"'][type='text/muon-template'][data-profile]").each(function(){var b=this.id.replace(/_template$/,""),c=b.match(/_([a-zA-Z0-9]*?)$/)[1];b=b.replace(RegExp("_"+c+"$"),"");var d=this.getAttribute("data-profile");m.packages[a].views[c][b].profiles=m.packages[a].views[c][b].profiles||[],m.packages[a].views[c][b].profiles.push(d),__profiles__[d]instanceof Array||(__profiles__[d]=[]),__profiles__[d].push("[data-muon='"+b+"_"+c+"'][data-pack='"+a+"']")})}function __profileSort__(a,b){return a.split(".").length>b.split(".").length?-1:a.split(".").length<b.split(".").length?1:0}function __templateForView__(a){var b=a.template+"_"+a.viewType,c="muon";a.constructor.profiles=a.constructor.profiles.sort(__profileSort__);for(var d in a.constructor.profiles)if(m.hasProfile(a.constructor.profiles[d])){c=a.constructor.profiles[d];break}return b="script#"+b+"_template",b+="[type='text/muon-template'][data-pack='"+a["package"]+"']",b+="[data-profile='"+c+"']",$(b)[0]}function __attrsParser__(a){var b={},c=a||"";c=c.split(";");for(var d in c){var e=c[d].split(":");2==e.length&&(b[e[0].replace(/^\s+/,"").replace(/\s+$/,"")]=e[1].replace(/^\s+/,"").replace(/\s+$/,""))}return b}function __getViewNameByType__(a,b,c,d,e){b||(b=c),d=d||__basePackage__,c=c||"",d=d||__basePackage__;try{var f=null;if(f||e||(f=m.packages[d].views[a][b]),!f&&("model"==a||"collection"==a)&&c){var g=c.replace(/:/g,".").split("."),h=b;for(var i in g)h=h.replace(RegExp("_"+g[i]+"$"),"");if(h!=b)return __getViewNameByType__(a,h,c,d,!0)}if(!f&&("model"==a||"collection"==a)&&c){for(var g=c.replace(/:/g,".").split(".").reverse().join("_");!m.packages[d].views[a][b+"_"+g]&&0!=g.length;){var j=g;g=g.replace(/^[a-zA-Z0-9]+_/,""),j==g&&(g="")}f=m.packages[d].views[a][b+(g?"_":"")+g]}if(!f&&e&&(f=m.packages[d].views[a][b]),!f)throw Error("not exists");return f}catch(k){if(-1==c.indexOf(":"))throw Error("Wrong view name:"+b+"_"+a+":"+c+":"+k.message);return __getViewNameByType__(a,b,c.substr(c.indexOf(":")+1),d,!0)}}function __checkPresenceInDom__(a){for(;a.parentElement;){if(a.parentElement==document.body)return!0;a=a.parentElement}return!1}function __getParentMuonView__(a){do{if(a.muonView instanceof m.View)return a;a=a.parentElement}while(a.parentElement);return null}function __insertView__(a,b,c,d){var e=this;if(!e.__removed__){if(!m.packages[c]||!m.packages[c].inited)return void m.requirePack(c,function(){__insertView__.apply(e,[a,b,c,d])});var f=a.getAttribute("data-projection"),g=a.getAttribute("data-"+b+"-view");if(g=="data-"+b+"-view"&&(g=""),f){var h=m.getProjection(f)?m:d.m;if($(h).one("projection_updated."+f,function(){__insertView__.apply(e,[a,b,c,d])}),$(h).one("projection_removed."+f,function(){a.muonView instanceof m.View&&a.muonView.remove(),$(h).one("projection_updated."+f,function(){__insertView__.apply(e,[a,b,c,d])})}),f=h.getProjection(f),void 0===f)return}setTimeout(function(){a.muonView instanceof m.View&&(a.muonView.remove(),delete a.muonView);try{$.when(__procProjection__[b].call(e,a,a.getAttribute("data-context"),f)).then(function(f){try{f=f||{};var h=__getViewNameByType__(b,g,f.modelName,c),i=__attrsParser__(a.getAttribute("data-view-attrs"));i.__autoGenerated__=!0,i.package=c,i.plugin=e.plugin,e.__inlineViews__.push(new(h.extend(i))(f,a))}catch(j){console.log(d.template,a),console.debug(j.stack)}})}catch(h){console.log(d.template,a),console.debug(h.stack)}},0),this.innerHTML=""}}function __getTranslation__(a){var b=this.pack().translation[this.template+"_"+this.viewType+":"+a.getAttribute("data-tr")];return m.isDebug()&&!b?$(a).addClass("untranslated"):$(a).removeClass("untranslated"),b||(m.isDebug()?"untranslated":"")}function __render__(){var a=this,b=this.tagName||"div",c=$("<"+b+" />");this.__renderTemplate__(c[0]),this.el&&this.el.muonView==this?(this.el.innerHTML="",$(this.el).append(c.children())):this.el=c[0],this.$el=$(this.el),this.$=_.bind(this.$el.find,this.$el),this.beforeRender&&this.beforeRender(),this.undelegateEvents(),this.delegateEvents(),this.$el.addClass([this.className,this.viewType,"block"].join(" ")),this.el.muonView=this,this.el.setAttribute("data-muon",this.template?this.template+"_"+this.viewType:""),this.el.setAttribute("data-pack",this["package"]),this.el.setAttribute("data-cid",this.cid),__renderDependencySrc__.call(this),__renderDataRoutes__.call(this),__renderTranslation__.call(this),__renderDebugLabels__.call(this),this.__set__&&this.__set__();for(var d in m.baseViews){var e=this.$el.find("[data-"+d+"-view]");e.each(function(){__insertView__.call(a,this,d,this.getAttribute("data-pack")||a["package"],a)})}this.rendered&&this.rendered(),this.__rendered__=!0,setTimeout(function(){a.trigger("rendered")})}function __renderDebugLabels__(){m.isDebug()&&!this.debugLabel&&(this.debugLabel=$("<div data-debug/>").text(this.package+":"+this.viewType+":"+(this.template||"")).appendTo(this.el),this.debugLabel.click(function(){$(this).toggleClass("pinned"),$(this).parent().toggleClass("pinned")}),__renderTranslation__.call(this))}function __renderTranslation__(){var a=this,b=this.$el.find("*[data-muon] *[data-tr]");this.$el.find("*[data-tr]").not(b).each(function(){try{this.innerHTML=__getTranslation__.call(a,this)}catch(b){console.log(b)}m.isDebug()&&(this.debugLabel=$("<div data-debug/>").text(a.package+":"+a.template+"_"+a.viewType+":"+this.getAttribute("data-tr")).appendTo(this))})}function __renderDataRoutes__(){var a=this;this.$el.find("a[data-route]").each(function(){var b=this.getAttribute("data-route"),c=this.getAttribute("data-pack")||a.package;c in m.packages&&(m.packages[c].routerPath&&(b=b.match(/^\/\//)?b.replace(/\/{2,}/g,"/"):b.match(/^\//)?(m.packages[c].routerPath+"/"+b).replace(/\/{2,}/g,"/"):"~"+b.replace(/\/{2,}/g,"/"),b=(__staticApp__?"#":"")+b.replace(/\^|\$/g,"")),$(this).attr("href",b).data("pack",c))})}function __renderDependencySrc__(){var a=this,b=this.$el.find("*[data-muon] *[data-src]");this.$el.find("*[data-src]").not(b).each(function(){this.src="/pack_src/"+a.package+"/"+this.getAttribute("data-src")+"?muon"}),__staticApp__&&["src","href"].map(function(b){$("["+b+"]",a.el).each(function(){/^\/\//.test($(this).attr(b))||$(this).attr(b,$(this).attr(b).replace(/^\//,""))})})}function __removeInnerViews__(){for(this.$("[data-muon]").each(function(){this.muonView instanceof m.View&&this.muonView.remove()});this.__inlineViews__.length>0;){var a=this.__inlineViews__.shift();a.remove()}}function __setGetElementValue__(a,b){function c(a){var b=this.getAttribute("data-attr-type");b?"text"==b?this.innerText=a:"html"==b?this.innerHTML=a:$(this).attr(b,a):"INPUT"==this.tagName||"SELECT"==this.tagName||"TEXTAREA"==this.tagName?$(this).val(a):this.innerText=a}if("function"==typeof a["get_"+b]){var d=a["get_"+b](this);null!==d&&"object"==typeof d&&"then"in d?d.then(c.bind(this)):c.call(this,d)}else c.call(this,a.model.get(b))}function __updateModelView__(a){var b=this;if(0!=this.$el.find("[data-model-attr]").length)for(var c in a){var d=this.el.getAttribute("data-attr-type"),e=this.$el.find("[data-model-attr^='"+c+"']");e.length&&e.each(function(){var b=this.getAttribute("data-model-attr").split("."),c=a[b.shift()];try{for(;0!=b.length;)c=c[b.shift()]}catch(e){c=c.toString()}d?"text"==d?this.innerText=c:"html"==d?this.innerHTML=c:$(this).attr(d,c):this.innerText=c})}this.$el.find("[data-model-get],[data-model-set]").each(function(){__setGetElementValue__.call(this,b,this.getAttribute("data-model-get")||this.getAttribute("data-model-set"))}),__renderDataRoutes__.call(this)}function __setEmptyFlag__(){0==this.collection.length?this.$el.addClass("empty-collection").removeClass("non-empty-collection"):this.$el.removeClass("empty-collection").addClass("non-empty-collection")}function __addToCollection__(a){__setEmptyFlag__.call(this);var b=a;if(0==this.target.children("#"+b.id).length){var c=new this.modelView(b),d=this.target.children()[this.collection.models.indexOf(b)+this.__keepChildrenLength__];d?c.$el.before(d):this.target.append(c.$el),this.childModels[b.id]=c}}function __removeFromCollection__(a){__setEmptyFlag__.call(this),a.id in this.childModels&&this.childModels[a.id].remove()}function __updateCollection__(a){if(__setEmptyFlag__.call(this),a==this.context){var b=this;if(!this.modelView)throw Error("No model view specified");var c=[];for(var d in a.models){var e=a.models[d];c.push("#"+e.id)}var f=this.target.children().not(c.join(", "));this.__keepChildren__.each(function(){f=f.not(this)}),f.each(function(){b.childModels[$(this).attr("id")].remove(),delete b.childModels[$(this).attr("id")]});var g=null;for(var d in a.models){var e=a.models[d];if(0==this.target.children("#"+e.id).length){var h=this.target.children()[d+this.__keepChildrenLength__];g=new this.modelView(e),h?g.$el.insertBefore(h):this.target.append(g.$el),this.childModels[e.id]=g}}}}function __sorted__(a){for(var b=0;b<a.length;b++){var c=a.models[b];this.target.append(this.childModels[c.id].$el)}}(function(){var a=this,b=a._,c={},d=Array.prototype,e=Object.prototype,f=Function.prototype,g=d.push,h=d.slice,i=d.concat,j=e.toString,k=e.hasOwnProperty,l=d.forEach,m=d.map,n=d.reduce,o=d.reduceRight,p=d.filter,q=d.every,r=d.some,s=d.indexOf,t=d.lastIndexOf,u=Array.isArray,v=Object.keys,w=f.bind,x=function(a){return a instanceof x?a:this instanceof x?void(this._wrapped=a):new x(a)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=x),exports._=x):a._=x,x.VERSION="1.5.2";var y=x.each=x.forEach=function(a,b,d){if(null!=a)if(l&&a.forEach===l)a.forEach(b,d);else if(a.length===+a.length){for(var e=0,f=a.length;f>e;e++)if(b.call(d,a[e],e,a)===c)return}else for(var g=x.keys(a),e=0,f=g.length;f>e;e++)if(b.call(d,a[g[e]],g[e],a)===c)return};x.map=x.collect=function(a,b,c){var d=[];return null==a?d:m&&a.map===m?a.map(b,c):(y(a,function(a,e,f){d.push(b.call(c,a,e,f))}),d)};var z="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),n&&a.reduce===n)return d&&(b=x.bind(b,d)),e?a.reduce(b,c):a.reduce(b);if(y(a,function(a,f,g){e?c=b.call(d,c,a,f,g):(c=a,e=!0)}),!e)throw new TypeError(z);return c},x.reduceRight=x.foldr=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),o&&a.reduceRight===o)return d&&(b=x.bind(b,d)),e?a.reduceRight(b,c):a.reduceRight(b);var f=a.length;if(f!==+f){var g=x.keys(a);f=g.length}if(y(a,function(h,i,j){i=g?g[--f]:--f,e?c=b.call(d,c,a[i],i,j):(c=a[i],e=!0)}),!e)throw new TypeError(z);return c},x.find=x.detect=function(a,b,c){var d;return A(a,function(a,e,f){return b.call(c,a,e,f)?(d=a,!0):void 0}),d},x.filter=x.select=function(a,b,c){var d=[];return null==a?d:p&&a.filter===p?a.filter(b,c):(y(a,function(a,e,f){b.call(c,a,e,f)&&d.push(a)}),d)},x.reject=function(a,b,c){return x.filter(a,function(a,d,e){return!b.call(c,a,d,e)},c)},x.every=x.all=function(a,b,d){b||(b=x.identity);var e=!0;return null==a?e:q&&a.every===q?a.every(b,d):(y(a,function(a,f,g){return(e=e&&b.call(d,a,f,g))?void 0:c}),!!e)};var A=x.some=x.any=function(a,b,d){b||(b=x.identity);var e=!1;return null==a?e:r&&a.some===r?a.some(b,d):(y(a,function(a,f,g){return e||(e=b.call(d,a,f,g))?c:void 0}),!!e)};x.contains=x.include=function(a,b){return null==a?!1:s&&a.indexOf===s?-1!=a.indexOf(b):A(a,function(a){return a===b})},x.invoke=function(a,b){var c=h.call(arguments,2),d=x.isFunction(b);return x.map(a,function(a){return(d?b:a[b]).apply(a,c)})},x.pluck=function(a,b){return x.map(a,function(a){return a[b]})},x.where=function(a,b,c){return x.isEmpty(b)?c?void 0:[]:x[c?"find":"filter"](a,function(a){for(var c in b)if(b[c]!==a[c])return!1;return!0})},x.findWhere=function(a,b){return x.where(a,b,!0)},x.max=function(a,b,c){if(!b&&x.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.max.apply(Math,a);if(!b&&x.isEmpty(a))return-1/0;var d={computed:-1/0,value:-1/0};return y(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g>d.computed&&(d={value:a,computed:g})}),d.value},x.min=function(a,b,c){if(!b&&x.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.min.apply(Math,a);if(!b&&x.isEmpty(a))return 1/0;var d={computed:1/0,value:1/0};return y(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g<d.computed&&(d={value:a,computed:g})}),d.value},x.shuffle=function(a){var b,c=0,d=[];return y(a,function(a){b=x.random(c++),d[c-1]=d[b],d[b]=a}),d},x.sample=function(a,b,c){return arguments.length<2||c?a[x.random(a.length-1)]:x.shuffle(a).slice(0,Math.max(0,b))};var B=function(a){return x.isFunction(a)?a:function(b){return b[a]}};x.sortBy=function(a,b,c){var d=B(b);return x.pluck(x.map(a,function(a,b,e){return{value:a,index:b,criteria:d.call(c,a,b,e)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(d>c||void 0===d)return-1}return a.index-b.index}),"value")};var C=function(a){return function(b,c,d){var e={},f=null==c?x.identity:B(c);return y(b,function(c,g){var h=f.call(d,c,g,b);a(e,h,c)}),e}};x.groupBy=C(function(a,b,c){(x.has(a,b)?a[b]:a[b]=[]).push(c)}),x.indexBy=C(function(a,b,c){a[b]=c}),x.countBy=C(function(a,b){x.has(a,b)?a[b]++:a[b]=1}),x.sortedIndex=function(a,b,c,d){c=null==c?x.identity:B(c);for(var e=c.call(d,b),f=0,g=a.length;g>f;){var h=f+g>>>1;c.call(d,a[h])<e?f=h+1:g=h}return f},x.toArray=function(a){return a?x.isArray(a)?h.call(a):a.length===+a.length?x.map(a,x.identity):x.values(a):[]},x.size=function(a){return null==a?0:a.length===+a.length?a.length:x.keys(a).length},x.first=x.head=x.take=function(a,b,c){return null==a?void 0:null==b||c?a[0]:h.call(a,0,b)},x.initial=function(a,b,c){return h.call(a,0,a.length-(null==b||c?1:b))},x.last=function(a,b,c){return null==a?void 0:null==b||c?a[a.length-1]:h.call(a,Math.max(a.length-b,0))},x.rest=x.tail=x.drop=function(a,b,c){return h.call(a,null==b||c?1:b)},x.compact=function(a){return x.filter(a,x.identity)};var D=function(a,b,c){return b&&x.every(a,x.isArray)?i.apply(c,a):(y(a,function(a){x.isArray(a)||x.isArguments(a)?b?g.apply(c,a):D(a,b,c):c.push(a)}),c)};x.flatten=function(a,b){return D(a,b,[])},x.without=function(a){return x.difference(a,h.call(arguments,1))},x.uniq=x.unique=function(a,b,c,d){x.isFunction(b)&&(d=c,c=b,b=!1);var e=c?x.map(a,c,d):a,f=[],g=[];return y(e,function(c,d){(b?d&&g[g.length-1]===c:x.contains(g,c))||(g.push(c),f.push(a[d]))}),f},x.union=function(){return x.uniq(x.flatten(arguments,!0))},x.intersection=function(a){var b=h.call(arguments,1);return x.filter(x.uniq(a),function(a){return x.every(b,function(b){return x.indexOf(b,a)>=0})})},x.difference=function(a){var b=i.apply(d,h.call(arguments,1));return x.filter(a,function(a){return!x.contains(b,a)})},x.zip=function(){for(var a=x.max(x.pluck(arguments,"length").concat(0)),b=new Array(a),c=0;a>c;c++)b[c]=x.pluck(arguments,""+c);return b},x.object=function(a,b){if(null==a)return{};for(var c={},d=0,e=a.length;e>d;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c},x.indexOf=function(a,b,c){if(null==a)return-1;var d=0,e=a.length;if(c){if("number"!=typeof c)return d=x.sortedIndex(a,b),a[d]===b?d:-1;d=0>c?Math.max(0,e+c):c}if(s&&a.indexOf===s)return a.indexOf(b,c);for(;e>d;d++)if(a[d]===b)return d;return-1},x.lastIndexOf=function(a,b,c){if(null==a)return-1;var d=null!=c;if(t&&a.lastIndexOf===t)return d?a.lastIndexOf(b,c):a.lastIndexOf(b);for(var e=d?c:a.length;e--;)if(a[e]===b)return e;return-1},x.range=function(a,b,c){arguments.length<=1&&(b=a||0,a=0),c=arguments[2]||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=0,f=new Array(d);d>e;)f[e++]=a,a+=c;return f};var E=function(){};x.bind=function(a,b){var c,d;if(w&&a.bind===w)return w.apply(a,h.call(arguments,1));if(!x.isFunction(a))throw new TypeError;return c=h.call(arguments,2),d=function(){if(!(this instanceof d))return a.apply(b,c.concat(h.call(arguments)));E.prototype=a.prototype;var e=new E;E.prototype=null;var f=a.apply(e,c.concat(h.call(arguments)));return Object(f)===f?f:e}},x.partial=function(a){var b=h.call(arguments,1);return function(){return a.apply(this,b.concat(h.call(arguments)))}},x.bindAll=function(a){var b=h.call(arguments,1);if(0===b.length)throw new Error("bindAll must be passed function names");return y(b,function(b){a[b]=x.bind(a[b],a)}),a},x.memoize=function(a,b){var c={};return b||(b=x.identity),function(){var d=b.apply(this,arguments);return x.has(c,d)?c[d]:c[d]=a.apply(this,arguments)}},x.delay=function(a,b){var c=h.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)},x.defer=function(a){return x.delay.apply(x,[a,1].concat(h.call(arguments,1)))},x.throttle=function(a,b,c){var d,e,f,g=null,h=0;c||(c={});var i=function(){h=c.leading===!1?0:new Date,g=null,f=a.apply(d,e)};return function(){var j=new Date;h||c.leading!==!1||(h=j);var k=b-(j-h);return d=this,e=arguments,0>=k?(clearTimeout(g),g=null,h=j,f=a.apply(d,e)):g||c.trailing===!1||(g=setTimeout(i,k)),f}},x.debounce=function(a,b,c){var d,e,f,g,h;return function(){f=this,e=arguments,g=new Date;var i=function(){var j=new Date-g;b>j?d=setTimeout(i,b-j):(d=null,c||(h=a.apply(f,e)))},j=c&&!d;return d||(d=setTimeout(i,b)),j&&(h=a.apply(f,e)),h}},x.once=function(a){var b,c=!1;return function(){return c?b:(c=!0,b=a.apply(this,arguments),a=null,b)}},x.wrap=function(a,b){return function(){var c=[a];return g.apply(c,arguments),b.apply(this,c)}},x.compose=function(){var a=arguments;return function(){for(var b=arguments,c=a.length-1;c>=0;c--)b=[a[c].apply(this,b)];return b[0]}},x.after=function(a,b){return function(){return--a<1?b.apply(this,arguments):void 0}},x.keys=v||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[];for(var c in a)x.has(a,c)&&b.push(c);return b},x.values=function(a){for(var b=x.keys(a),c=b.length,d=new Array(c),e=0;c>e;e++)d[e]=a[b[e]];return d},x.pairs=function(a){for(var b=x.keys(a),c=b.length,d=new Array(c),e=0;c>e;e++)d[e]=[b[e],a[b[e]]];return d},x.invert=function(a){for(var b={},c=x.keys(a),d=0,e=c.length;e>d;d++)b[a[c[d]]]=c[d];return b},x.functions=x.methods=function(a){var b=[];for(var c in a)x.isFunction(a[c])&&b.push(c);return b.sort()},x.extend=function(a){return y(h.call(arguments,1),function(b){if(b)for(var c in b)a[c]=b[c]}),a},x.pick=function(a){var b={},c=i.apply(d,h.call(arguments,1));return y(c,function(c){c in a&&(b[c]=a[c])}),b},x.omit=function(a){var b={},c=i.apply(d,h.call(arguments,1));for(var e in a)x.contains(c,e)||(b[e]=a[e]);return b},x.defaults=function(a){return y(h.call(arguments,1),function(b){if(b)for(var c in b)void 0===a[c]&&(a[c]=b[c])}),a},x.clone=function(a){return x.isObject(a)?x.isArray(a)?a.slice():x.extend({},a):a},x.tap=function(a,b){return b(a),a};var F=function(a,b,c,d){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a instanceof x&&(a=a._wrapped),b instanceof x&&(b=b._wrapped);var e=j.call(a);if(e!=j.call(b))return!1;switch(e){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var f=c.length;f--;)if(c[f]==a)return d[f]==b;var g=a.constructor,h=b.constructor;if(g!==h&&!(x.isFunction(g)&&g instanceof g&&x.isFunction(h)&&h instanceof h))return!1;c.push(a),d.push(b);var i=0,k=!0;if("[object Array]"==e){if(i=a.length,k=i==b.length)for(;i--&&(k=F(a[i],b[i],c,d)););}else{for(var l in a)if(x.has(a,l)&&(i++,!(k=x.has(b,l)&&F(a[l],b[l],c,d))))break;if(k){for(l in b)if(x.has(b,l)&&!i--)break;k=!i}}return c.pop(),d.pop(),k};x.isEqual=function(a,b){return F(a,b,[],[])},x.isEmpty=function(a){if(null==a)return!0;if(x.isArray(a)||x.isString(a))return 0===a.length;for(var b in a)if(x.has(a,b))return!1;return!0},x.isElement=function(a){return!(!a||1!==a.nodeType)},x.isArray=u||function(a){return"[object Array]"==j.call(a)},x.isObject=function(a){return a===Object(a)},y(["Arguments","Function","String","Number","Date","RegExp"],function(a){x["is"+a]=function(b){return j.call(b)=="[object "+a+"]"}}),x.isArguments(arguments)||(x.isArguments=function(a){return!(!a||!x.has(a,"callee"))}),"function"!=typeof/./&&(x.isFunction=function(a){return"function"==typeof a}),x.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},x.isNaN=function(a){return x.isNumber(a)&&a!=+a},x.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"==j.call(a)},x.isNull=function(a){return null===a},x.isUndefined=function(a){return void 0===a},x.has=function(a,b){return k.call(a,b)},x.noConflict=function(){return a._=b,this},x.identity=function(a){return a},x.times=function(a,b,c){for(var d=Array(Math.max(0,a)),e=0;a>e;e++)d[e]=b.call(c,e);return d},x.random=function(a,b){return null==b&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))};var G={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};G.unescape=x.invert(G.escape);var H={escape:new RegExp("["+x.keys(G.escape).join("")+"]","g"),unescape:new RegExp("("+x.keys(G.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(a){x[a]=function(b){return null==b?"":(""+b).replace(H[a],function(b){return G[a][b]})}}),x.result=function(a,b){if(null==a)return void 0;var c=a[b];return x.isFunction(c)?c.call(a):c},x.mixin=function(a){y(x.functions(a),function(b){var c=x[b]=a[b];x.prototype[b]=function(){var a=[this._wrapped];return g.apply(a,arguments),M.call(this,c.apply(x,a))}})};var I=0;x.uniqueId=function(a){var b=++I+"";return a?a+b:b},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var J=/(.)^/,K={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},L=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(a,b,c){var d;c=x.defaults({},c,x.templateSettings);var e=new RegExp([(c.escape||J).source,(c.interpolate||J).source,(c.evaluate||J).source].join("|")+"|$","g"),f=0,g="__p+='";a.replace(e,function(b,c,d,e,h){return g+=a.slice(f,h).replace(L,function(a){return"\\"+K[a]}),c&&(g+="'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'"),d&&(g+="'+\n((__t=("+d+"))==null?'':__t)+\n'"),e&&(g+="';\n"+e+"\n__p+='"),f=h+b.length,b}),g+="';\n",c.variable||(g="with(obj||{}){\n"+g+"}\n"),g="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+g+"return __p;\n";try{d=new Function(c.variable||"obj","_",g)}catch(h){throw h.source=g,h}if(b)return d(b,x);var i=function(a){return d.call(this,a,x)};return i.source="function("+(c.variable||"obj")+"){\n"+g+"}",i},x.chain=function(a){return x(a).chain()};var M=function(a){return this._chain?x(a).chain():a};x.mixin(x),y(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=d[a];x.prototype[a]=function(){var c=this._wrapped;return b.apply(c,arguments),"shift"!=a&&"splice"!=a||0!==c.length||delete c[0],M.call(this,c)}}),y(["concat","join","slice"],function(a){var b=d[a];x.prototype[a]=function(){return M.call(this,b.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this),function(){{var a,b=this,c=b.Backbone,d=[],e=(d.push,d.slice);d.splice}a="undefined"!=typeof exports?exports:b.Backbone={},a.VERSION="1.1.0";var f=b._;f||"undefined"==typeof require||(f=require("underscore")),a.$=b.jQuery||b.Zepto||b.ender||b.$,a.noConflict=function(){return b.Backbone=c,this},a.emulateHTTP=!1,a.emulateJSON=!1;var g=a.Events={on:function(a,b,c){if(!i(this,"on",a,[b,c])||!b)return this;this._events||(this._events={});var d=this._events[a]||(this._events[a]=[]);return d.push({callback:b,context:c,ctx:c||this}),this},once:function(a,b,c){if(!i(this,"once",a,[b,c])||!b)return this;var d=this,e=f.once(function(){d.off(a,e),b.apply(this,arguments)});return e._callback=b,this.on(a,e,c)},off:function(a,b,c){var d,e,g,h,j,k,l,m;if(!this._events||!i(this,"off",a,[b,c]))return this;if(!a&&!b&&!c)return this._events={},this;for(h=a?[a]:f.keys(this._events),j=0,k=h.length;k>j;j++)if(a=h[j],g=this._events[a]){if(this._events[a]=d=[],b||c)for(l=0,m=g.length;m>l;l++)e=g[l],(b&&b!==e.callback&&b!==e.callback._callback||c&&c!==e.context)&&d.push(e);d.length||delete this._events[a]}return this},trigger:function(a){if(!this._events)return this;var b=e.call(arguments,1);if(!i(this,"trigger",a,b))return this;var c=this._events[a],d=this._events.all;return c&&j(c,b),d&&j(d,arguments),this},stopListening:function(a,b,c){var d=this._listeningTo;if(!d)return this;var e=!b&&!c;c||"object"!=typeof b||(c=this),a&&((d={})[a._listenId]=a);for(var g in d)a=d[g],a.off(b,c,this),(e||f.isEmpty(a._events))&&delete this._listeningTo[g];return this}},h=/\s+/,i=function(a,b,c,d){if(!c)return!0;if("object"==typeof c){for(var e in c)a[b].apply(a,[e,c[e]].concat(d));return!1}if(h.test(c)){for(var f=c.split(h),g=0,i=f.length;i>g;g++)a[b].apply(a,[f[g]].concat(d));return!1}return!0},j=function(a,b){var c,d=-1,e=a.length,f=b[0],g=b[1],h=b[2];switch(b.length){case 0:for(;++d<e;)(c=a[d]).callback.call(c.ctx);return;case 1:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f);return;case 2:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g);return;case 3:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g,h);return;default:for(;++d<e;)(c=a[d]).callback.apply(c.ctx,b)}},k={listenTo:"on",listenToOnce:"once"};f.each(k,function(a,b){g[b]=function(b,c,d){var e=this._listeningTo||(this._listeningTo={}),g=b._listenId||(b._listenId=f.uniqueId("l"));return e[g]=b,d||"object"!=typeof c||(d=this),b[a](c,d,this),this}}),g.bind=g.on,g.unbind=g.off,f.extend(a,g);var l=a.Model=function(a,b){var c=a||{};b||(b={}),this.cid=f.uniqueId("c"),this.attributes={},b.collection&&(this.collection=b.collection),b.parse&&(c=this.parse(c,b)||{}),c=f.defaults({},c,f.result(this,"defaults")),this.set(c,b),this.changed={},this.initialize.apply(this,arguments)};f.extend(l.prototype,g,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(){return f.clone(this.attributes)},sync:function(){return a.sync.apply(this,arguments)},get:function(a){return this.attributes[a]},escape:function(a){return f.escape(this.get(a))},has:function(a){return null!=this.get(a)},set:function(a,b,c){var d,e,g,h,i,j,k,l;if(null==a)return this;if("object"==typeof a?(e=a,c=b):(e={})[a]=b,c||(c={}),!this._validate(e,c))return!1;g=c.unset,i=c.silent,h=[],j=this._changing,this._changing=!0,j||(this._previousAttributes=f.clone(this.attributes),this.changed={}),l=this.attributes,k=this._previousAttributes,this.idAttribute in e&&(this.id=e[this.idAttribute]);for(d in e)b=e[d],f.isEqual(l[d],b)||h.push(d),f.isEqual(k[d],b)?delete this.changed[d]:this.changed[d]=b,g?delete l[d]:l[d]=b;if(!i){h.length&&(this._pending=!0);for(var m=0,n=h.length;n>m;m++)this.trigger("change:"+h[m],this,l[h[m]],c)}if(j)return this;if(!i)for(;this._pending;)this._pending=!1,this.trigger("change",this,c);return this._pending=!1,this._changing=!1,this},unset:function(a,b){return this.set(a,void 0,f.extend({},b,{unset:!0}))},clear:function(a){var b={};for(var c in this.attributes)b[c]=void 0;return this.set(b,f.extend({},a,{unset:!0}))},hasChanged:function(a){return null==a?!f.isEmpty(this.changed):f.has(this.changed,a)},changedAttributes:function(a){if(!a)return this.hasChanged()?f.clone(this.changed):!1;var b,c=!1,d=this._changing?this._previousAttributes:this.attributes;for(var e in a)f.isEqual(d[e],b=a[e])||((c||(c={}))[e]=b);return c},previous:function(a){return null!=a&&this._previousAttributes?this._previousAttributes[a]:null
},previousAttributes:function(){return f.clone(this._previousAttributes)},fetch:function(a){a=a?f.clone(a):{},void 0===a.parse&&(a.parse=!0);var b=this,c=a.success;return a.success=function(d){return b.set(b.parse(d,a),a)?(c&&c(b,d,a),void b.trigger("sync",b,d,a)):!1},K(this,a),this.sync("read",this,a)},save:function(a,b,c){var d,e,g,h=this.attributes;if(null==a||"object"==typeof a?(d=a,c=b):(d={})[a]=b,c=f.extend({validate:!0},c),d&&!c.wait){if(!this.set(d,c))return!1}else if(!this._validate(d,c))return!1;d&&c.wait&&(this.attributes=f.extend({},h,d)),void 0===c.parse&&(c.parse=!0);var i=this,j=c.success;return c.success=function(a){i.attributes=h;var b=i.parse(a,c);return c.wait&&(b=f.extend(d||{},b)),f.isObject(b)&&!i.set(b,c)?!1:(j&&j(i,a,c),void i.trigger("sync",i,a,c))},K(this,c),e=this.isNew()?"create":c.patch?"patch":"update","patch"===e&&(c.attrs=d),g=this.sync(e,this,c),d&&c.wait&&(this.attributes=h),g},destroy:function(a){a=a?f.clone(a):{};var b=this,c=a.success,d=function(){b.trigger("destroy",b,b.collection,a)};if(a.success=function(e){(a.wait||b.isNew())&&d(),c&&c(b,e,a),b.isNew()||b.trigger("sync",b,e,a)},this.isNew())return a.success(),!1;K(this,a);var e=this.sync("delete",this,a);return a.wait||d(),e},url:function(){var a=f.result(this,"urlRoot")||f.result(this.collection,"url")||J();return this.isNew()?a:a+("/"===a.charAt(a.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(a){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},isValid:function(a){return this._validate({},f.extend(a||{},{validate:!0}))},_validate:function(a,b){if(!b.validate||!this.validate)return!0;a=f.extend({},this.attributes,a);var c=this.validationError=this.validate(a,b)||null;return c?(this.trigger("invalid",this,c,f.extend(b,{validationError:c})),!1):!0}});var m=["keys","values","pairs","invert","pick","omit"];f.each(m,function(a){l.prototype[a]=function(){var b=e.call(arguments);return b.unshift(this.attributes),f[a].apply(f,b)}});var n=a.Collection=function(a,b){b||(b={}),b.model&&(this.model=b.model),void 0!==b.comparator&&(this.comparator=b.comparator),this._reset(),this.initialize.apply(this,arguments),a&&this.reset(a,f.extend({silent:!0},b))},o={add:!0,remove:!0,merge:!0},p={add:!0,remove:!1};f.extend(n.prototype,g,{model:l,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},sync:function(){return a.sync.apply(this,arguments)},add:function(a,b){return this.set(a,f.extend({merge:!1},b,p))},remove:function(a,b){var c=!f.isArray(a);a=c?[a]:f.clone(a),b||(b={});var d,e,g,h;for(d=0,e=a.length;e>d;d++)h=a[d]=this.get(a[d]),h&&(delete this._byId[h.id],delete this._byId[h.cid],g=this.indexOf(h),this.models.splice(g,1),this.length--,b.silent||(b.index=g,h.trigger("remove",h,this,b)),this._removeReference(h));return c?a[0]:a},set:function(a,b){b=f.defaults({},b,o),b.parse&&(a=this.parse(a,b));var c=!f.isArray(a);a=c?a?[a]:[]:f.clone(a);var d,e,g,h,i,j,k,m=b.at,n=this.model,p=this.comparator&&null==m&&b.sort!==!1,q=f.isString(this.comparator)?this.comparator:null,r=[],s=[],t={},u=b.add,v=b.merge,w=b.remove,x=!p&&u&&w?[]:!1;for(d=0,e=a.length;e>d;d++){if(i=a[d],g=i instanceof l?h=i:i[n.prototype.idAttribute],j=this.get(g))w&&(t[j.cid]=!0),v&&(i=i===h?h.attributes:i,b.parse&&(i=j.parse(i,b)),j.set(i,b),p&&!k&&j.hasChanged(q)&&(k=!0)),a[d]=j;else if(u){if(h=a[d]=this._prepareModel(i,b),!h)continue;r.push(h),h.on("all",this._onModelEvent,this),this._byId[h.cid]=h,null!=h.id&&(this._byId[h.id]=h)}x&&x.push(j||h)}if(w){for(d=0,e=this.length;e>d;++d)t[(h=this.models[d]).cid]||s.push(h);s.length&&this.remove(s,b)}if(r.length||x&&x.length)if(p&&(k=!0),this.length+=r.length,null!=m)for(d=0,e=r.length;e>d;d++)this.models.splice(m+d,0,r[d]);else{x&&(this.models.length=0);var y=x||r;for(d=0,e=y.length;e>d;d++)this.models.push(y[d])}if(k&&this.sort({silent:!0}),!b.silent){for(d=0,e=r.length;e>d;d++)(h=r[d]).trigger("add",h,this,b);(k||x&&x.length)&&this.trigger("sort",this,b)}return c?a[0]:a},reset:function(a,b){b||(b={});for(var c=0,d=this.models.length;d>c;c++)this._removeReference(this.models[c]);return b.previousModels=this.models,this._reset(),a=this.add(a,f.extend({silent:!0},b)),b.silent||this.trigger("reset",this,b),a},push:function(a,b){return this.add(a,f.extend({at:this.length},b))},pop:function(a){var b=this.at(this.length-1);return this.remove(b,a),b},unshift:function(a,b){return this.add(a,f.extend({at:0},b))},shift:function(a){var b=this.at(0);return this.remove(b,a),b},slice:function(){return e.apply(this.models,arguments)},get:function(a){return null==a?void 0:this._byId[a.id]||this._byId[a.cid]||this._byId[a]},at:function(a){return this.models[a]},where:function(a,b){return f.isEmpty(a)?b?void 0:[]:this[b?"find":"filter"](function(b){for(var c in a)if(a[c]!==b.get(c))return!1;return!0})},findWhere:function(a){return this.where(a,!0)},sort:function(a){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return a||(a={}),f.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(f.bind(this.comparator,this)),a.silent||this.trigger("sort",this,a),this},pluck:function(a){return f.invoke(this.models,"get",a)},fetch:function(a){a=a?f.clone(a):{},void 0===a.parse&&(a.parse=!0);var b=a.success,c=this;return a.success=function(d){var e=a.reset?"reset":"set";c[e](d,a),b&&b(c,d,a),c.trigger("sync",c,d,a)},K(this,a),this.sync("read",this,a)},create:function(a,b){if(b=b?f.clone(b):{},!(a=this._prepareModel(a,b)))return!1;b.wait||this.add(a,b);var c=this,d=b.success;return b.success=function(a,b,e){e.wait&&c.add(a,e),d&&d(a,b,e)},a.save(null,b),a},parse:function(a){return a},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(a,b){if(a instanceof l)return a.collection||(a.collection=this),a;b=b?f.clone(b):{},b.collection=this;var c=new this.model(a,b);return c.validationError?(this.trigger("invalid",this,c.validationError,b),!1):c},_removeReference:function(a){this===a.collection&&delete a.collection,a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,c,d){("add"!==a&&"remove"!==a||c===this)&&("destroy"===a&&this.remove(b,d),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],null!=b.id&&(this._byId[b.id]=b)),this.trigger.apply(this,arguments))}});var q=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain"];f.each(q,function(a){n.prototype[a]=function(){var b=e.call(arguments);return b.unshift(this.models),f[a].apply(f,b)}});var r=["groupBy","countBy","sortBy"];f.each(r,function(a){n.prototype[a]=function(b,c){var d=f.isFunction(b)?b:function(a){return a.get(b)};return f[a](this.models,d,c)}});var s=a.View=function(a){this.cid=f.uniqueId("view"),a||(a={}),f.extend(this,f.pick(a,u)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},t=/^(\S+)\s*(.*)$/,u=["model","collection","el","id","attributes","className","tagName","events"];f.extend(s.prototype,g,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(b,c){return this.$el&&this.undelegateEvents(),this.$el=b instanceof a.$?b:a.$(b),this.el=this.$el[0],c!==!1&&this.delegateEvents(),this},delegateEvents:function(a){if(!a&&!(a=f.result(this,"events")))return this;this.undelegateEvents();for(var b in a){var c=a[b];if(f.isFunction(c)||(c=this[a[b]]),c){var d=b.match(t),e=d[1],g=d[2];c=f.bind(c,this),e+=".delegateEvents"+this.cid,""===g?this.$el.on(e,c):this.$el.on(e,g,c)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(this.el)this.setElement(f.result(this,"el"),!1);else{var b=f.extend({},f.result(this,"attributes"));this.id&&(b.id=f.result(this,"id")),this.className&&(b["class"]=f.result(this,"className"));var c=a.$("<"+f.result(this,"tagName")+">").attr(b);this.setElement(c,!1)}}}),a.sync=function(b,c,d){var e=w[b];f.defaults(d||(d={}),{emulateHTTP:a.emulateHTTP,emulateJSON:a.emulateJSON});var g={type:e,dataType:"json"};if(d.url||(g.url=f.result(c,"url")||J()),null!=d.data||!c||"create"!==b&&"update"!==b&&"patch"!==b||(g.contentType="application/json",g.data=JSON.stringify(d.attrs||c.toJSON(d))),d.emulateJSON&&(g.contentType="application/x-www-form-urlencoded",g.data=g.data?{model:g.data}:{}),d.emulateHTTP&&("PUT"===e||"DELETE"===e||"PATCH"===e)){g.type="POST",d.emulateJSON&&(g.data._method=e);var h=d.beforeSend;d.beforeSend=function(a){return a.setRequestHeader("X-HTTP-Method-Override",e),h?h.apply(this,arguments):void 0}}"GET"===g.type||d.emulateJSON||(g.processData=!1),"PATCH"===g.type&&v&&(g.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var i=d.xhr=a.ajax(f.extend(g,d));return c.trigger("request",c,i,d),i};var v=!("undefined"==typeof window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent),w={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};a.ajax=function(){return a.$.ajax.apply(a.$,arguments)};var x=a.Router=function(a){a||(a={}),a.routes&&(this.routes=a.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},y=/\((.*?)\)/g,z=/(\(\?)?:\w+/g,A=/\*\w+/g,B=/[\-{}\[\]+?.,\\\^$|#\s]/g;f.extend(x.prototype,g,{initialize:function(){},route:function(b,c,d){f.isRegExp(b)||(b=this._routeToRegExp(b)),f.isFunction(c)&&(d=c,c=""),d||(d=this[c]);var e=this;return a.history.route(b,function(f){var g=e._extractParameters(b,f);d&&d.apply(e,g),e.trigger.apply(e,["route:"+c].concat(g)),e.trigger("route",c,g),a.history.trigger("route",e,c,g)}),this},navigate:function(b,c){return a.history.navigate(b,c),this},_bindRoutes:function(){if(this.routes){this.routes=f.result(this,"routes");for(var a,b=f.keys(this.routes);null!=(a=b.pop());)this.route(a,this.routes[a])}},_routeToRegExp:function(a){return a=a.replace(B,"\\$&").replace(y,"(?:$1)?").replace(z,function(a,b){return b?a:"([^/]+)"}).replace(A,"(.*?)"),new RegExp("^"+a+"$")},_extractParameters:function(a,b){var c=a.exec(b).slice(1);return f.map(c,function(a){return a?decodeURIComponent(a):null})}});var C=a.History=function(){this.handlers=[],f.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},D=/^[#\/]|\s+$/g,E=/^\/+|\/+$/g,F=/msie [\w.]+/,G=/\/$/,H=/[?#].*$/;C.started=!1,f.extend(C.prototype,g,{interval:50,getHash:function(a){var b=(a||this).location.href.match(/#(.*)$/);return b?b[1]:""},getFragment:function(a,b){if(null==a)if(this._hasPushState||!this._wantsHashChange||b){a=this.location.pathname;var c=this.root.replace(G,"");a.indexOf(c)||(a=a.slice(c.length))}else a=this.getHash();return a.replace(D,"")},start:function(b){if(C.started)throw new Error("Backbone.history has already been started");C.started=!0,this.options=f.extend({root:"/"},this.options,b),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var c=this.getFragment(),d=document.documentMode,e=F.exec(navigator.userAgent.toLowerCase())&&(!d||7>=d);this.root=("/"+this.root+"/").replace(E,"/"),e&&this._wantsHashChange&&(this.iframe=a.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(c)),this._hasPushState?a.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!e?a.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=c;var g=this.location,h=g.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!h)return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0;this._hasPushState&&h&&g.hash&&(this.fragment=this.getHash().replace(D,""),this.history.replaceState({},document.title,this.root+this.fragment+g.search))}return this.options.silent?void 0:this.loadUrl()},stop:function(){a.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),C.started=!1},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(){var a=this.getFragment();return a===this.fragment&&this.iframe&&(a=this.getFragment(this.getHash(this.iframe))),a===this.fragment?!1:(this.iframe&&this.navigate(a),void this.loadUrl())},loadUrl:function(a){return a=this.fragment=this.getFragment(a),f.any(this.handlers,function(b){return b.route.test(a)?(b.callback(a),!0):void 0})},navigate:function(a,b){if(!C.started)return!1;b&&b!==!0||(b={trigger:!!b});var c=this.root+(a=this.getFragment(a||""));if(a=a.replace(H,""),this.fragment!==a){if(this.fragment=a,""===a&&"/"!==c&&(c=c.slice(0,-1)),this._hasPushState)this.history[b.replace?"replaceState":"pushState"]({},document.title,c);else{if(!this._wantsHashChange)return this.location.assign(c);this._updateHash(this.location,a,b.replace),this.iframe&&a!==this.getFragment(this.getHash(this.iframe))&&(b.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,a,b.replace))}return b.trigger?this.loadUrl(a):void 0}},_updateHash:function(a,b,c){if(c){var d=a.href.replace(/(javascript:|#).*$/,"");a.replace(d+"#"+b)}else a.hash="#"+b}}),a.history=new C;var I=function(a,b){var c,d=this;c=a&&f.has(a,"constructor")?a.constructor:function(){return d.apply(this,arguments)},f.extend(c,d,b);var e=function(){this.constructor=c};return e.prototype=d.prototype,c.prototype=new e,a&&f.extend(c.prototype,a),c.__super__=d.prototype,c};l.extend=n.extend=x.extend=s.extend=C.extend=I;var J=function(){throw new Error('A "url" property or function must be specified')},K=function(a,b){var c=b.error;b.error=function(d){c&&c(a,d,b),a.trigger("error",a,d,b)}}}.call(this),function(a){function b(b,c){throw a.extend(b,c),b}function c(a){var b=[];if(n.call(a)!==h)return!1;for(var c=0,d=a.length;d>c;c++)b[c]=a[c].jqote_id;return b.length?b.sort().join(".").replace(/(\b\d+\b)\.(?:\1(\.|$))+/g,"$1$2"):!1}function d(b,c){var e,f=[],c=c||l,g=n.call(b);if(g===j)return b.jqote_id?[b]:!1;if(g!==h)return[a.jqotec(b,c)];if(g===h)for(var i=0,k=b.length;k>i;i++)(e=d(b[i],c))&&f.push(e[0]);return f.length?f:!1}var e="UndefinedTemplateError",f="TemplateCompilationError",g="TemplateExecutionError",h="[object Array]",i="[object String]",j="[object Function]",k=1,l="%",m=/^[^<]*(<[\w\W]+>)[^>]*$/,n=Object.prototype.toString;a.fn.extend({jqote:function(b,c){var b=n.call(b)===h?b:[b],d="";return this.each(function(e){for(var f=a.jqotec(this,c),g=0;g<b.length;g++)d+=f.call(b[g],e,g,b,f)}),d}}),a.each({app:"append",pre:"prepend",sub:"html"},function(b,e){a.fn["jqote"+b]=function(f,g,h){var i,j,k=a.jqote(f,g,h),l=m.test(k)?a:function(b){return a(document.createTextNode(b))};return(i=c(d(f)))&&(j=new RegExp("(^|\\.)"+i.split(".").join("\\.(.*)?")+"(\\.|$)")),this.each(function(){var c=l(k);a(this)[e](c),(3===c[0].nodeType?a(this):c).trigger("jqote."+b,[c,j])})}}),a.extend({jqote:function(a,c,f){var g="",f=f||l,i=d(a,f);i===!1&&b(new Error("Empty or undefined template passed to $.jqote"),{type:e}),c=n.call(c)!==h?[c]:c;for(var j=0,k=i.length;k>j;j++)for(var m=0;m<c.length;m++)g+=i[j].call(c[m],j,m,c,i[j]);return g},jqotec:function(c,d){var h,j,o,d=d||l,p=n.call(c);if(p===i&&m.test(c)){if(j=o=c,h=a.jqotecache[c])return h}else if(j=p===i||c.nodeType?a(c):c instanceof jQuery?c:null,j[0]&&((o=j[0].innerHTML)||(o=j.text()))||b(new Error("Empty or undefined template passed to $.jqotec"),{type:e}),h=a.jqotecache[a.data(j[0],"jqote_id")])return h;for(var q,r="",s=o.replace(/\s*<!\[CDATA\[\s*|\s*\]\]>\s*|[\r\n\t]/g,"").split("<"+d).join(d+">").split(d+">"),t=0,u=s.length;u>t;t++)r+=""!==s[t].charAt(0)?"out+='"+s[t].replace(/(\\|["'])/g,"\\$1")+"'":"="===s[t].charAt(1)?";out+=("+s[t].substr(2)+");":"!"===s[t].charAt(1)?";out+=$.jqotenc(("+s[t].substr(2)+"));":";"+s[t].substr(1);r="try{"+('var out="";'+r+";return out;").split("out+='';").join("").split('var out="";out+=').join("var out=")+'}catch(e){e.type="'+g+'";e.args=arguments;e.template=arguments.callee.toString();throw e;}';try{var v=new Function("i, j, data, fn",r)}catch(w){b(w,{type:f})}return q=j instanceof jQuery?a.data(j[0],"jqote_id",k):j,a.jqotecache[q]=(v.jqote_id=k++,v)},jqotefn:function(b){var c=n.call(b),d=c===i&&m.test(b)?b:a.data(a(b)[0],"jqote_id");return a.jqotecache[d]||!1},jqotetag:function(a){n.call(a)===i&&(l=a)},jqotenc:function(a){return a.toString().replace(/&(?!\w+;)/g,"&#38;").split("<").join("&#60;").split(">").join("&#62;").split('"').join("&#34;").split("'").join("&#39;")},jqotecache:{}}),a.event.special.jqote={add:function(a){var b,e=a.handler,f=a.data?n.call(a.data)!==h?[a.data]:a.data:[];a.namespace||(a.namespace="app.pre.sub"),f.length&&(b=c(d(f)))&&(a.handler=function(a,c,d){return!d||d.test(b)?e.apply(this,[a,c]):null})}}}(jQuery);var __b__=window.Backbone;delete window.Backbone;var __MuonBase__={__projections__:{},packages:{},models:{},plugins:{},collections:{},dependencies:[],baseViews:{}},__MuonPackBase__={views:{},viewsUnnamed:{},routerPath:null,loaded:!1,inited:!1,translation:{}},__syncNames__={},__defaultLang__=document.getElementsByTagName("html")[0].lang||"en",__debug__=!1,__profiles__={},__plugins__={},__history__=[],__forwardHistory__=[],__views__={},__currentPackage__="",__currentPlugin__="",__onReady__=[],__staticApp__=!0,__basePackage__="application",__applicationView__=null,__viewBackboneExtend__=__b__.View.extend,__modelBackboneExtend__=__b__.Model.extend,__collectionBackboneExtend__=__b__.Collection.extend;window.getAllView=__getAllViewEls__,window.profiles=__profiles__;var __timeStart__=Date.now();_.extend(MuonPlugin.prototype,{getProjection:function(a){return this.__projections__[a]},setProjection:function(a,b){_.isEqual(b,this.__projections__[a])||(this.__projections__[a]=b,$(this).trigger("projection_updated."+a,b))},removeProjection:function(a){try{var b=this.__projections__[a];return delete this.__projections__[a],$(this).trigger("projection_removed."+a),b}catch(c){return console.log(c.message,c.stack)}}});var m=_.extend(new MuonPlugin(""),{packageInitData:{},__views__:__views__,MuonPackage:MuonPackage,MuonPlugin:MuonPlugin,on:function(){},off:function(){},once:function(){},isDebug:function(){return __debug__},setDebug:function(a){__debug__=!!a,__debug__?(/debug/.test(document.body.className)&&(document.body.className+=" debug"),$("*[data-muon]").each(function(){this.muonView instanceof m.View&&this.muonView.__renderDebugLabels__()})):$("body").removeClass("debug")},setLanguage:function(a){document.getElementsByTagName("html")[0].lang=a||__defaultLang__;var b=[];for(var c in m.packages)b.push(c);$.getJSON("/pack_translation/"+a,{packs:b.join(",")}).then(function(a){for(var b in a)b in m.packages&&(m.packages[b].translation=a[b]);$("[data-muon]").each(function(){this.muonView instanceof m.View&&this.muonView.__renderTranslation__()})})},getLanguage:function(){return document.getElementsByTagName("html")[0].lang||__defaultLang__},setProfile:function(a,b){if("muon"!=a){if(b===!1)return m.removeProfile(a);if(!m.hasProfile(a)){var c=document.body.className.split(/\s+/);a=a.split("."),c=c.filter(function(b){return-1==a.indexOf(b)}),c=c.concat(a),document.body.className=c.sort().join(" ");var d=_.keys(__profiles__).filter(function(b){return RegExp(a.sort().join(".([a-zA-Z0-9_]+.)*?")).test(b)});if(d=d.filter(function(a){return m.hasProfile(a)}),0!=d.length){var e=[];for(var f in d)e=e.concat(__profiles__[d[f]]);$(__getAllViewEls__()).filter(e.join(",")).each(function(){this.muonView instanceof m.View&&this.muonView.reload()})}}}},removeProfile:function(a){"muon"!=a&&_.defer(function(){if(m.hasProfile(a)){var b=_.keys(__profiles__).filter(function(b){return RegExp(a.split(".").sort().join(".([a-zA-Z0-9_]+.)*?")).test(b)});if(b=b.filter(function(a){return m.hasProfile(a)}),$("body").removeClass(a),0!=b.length){var c=[];for(var d in b)c=c.concat(__profiles__[b[d]]);$(__getAllViewEls__()).filter(c.join(",")).each(function(){this.muonView instanceof m.View&&this.muonView.reload()})}}})},hasProfile:function(a){return RegExp(a.split(".").map(function(a){return"\\b"+a+"\\b"}).sort().join("\\.([a-zA-Z0-9_]+\\.)*?")).test(document.body.className.split(/\s+/).sort().join("."))},getProfile:function(){return document.body.className.split(/\s+/).sort().join(".")},log:function(){var a=[].slice.apply(arguments);a.unshift("["+(Date.now()-__timeStart__)/1e3+"]"),console.log.apply(console,a)},error:function(){var a=[].slice.apply(arguments);a.unshift("["+(Date.now()-__timeStart__)/1e3+"]"),console.error.apply(console,a)}});m.packages[""]=new m.MuonPackage(""),__plugins__[""]=m,$(function(){for(var a in __onReady__)try{__onReady__[a]()}catch(b){m.error(b)}delete __onReady__}),window.muon=window.m=m;var __routes__=[];$.ajaxSetup({beforeSend:function(a){a.setRequestHeader("Muon-Request","data-request")}});var __History__=__b__.History;__b__.History.prototype.navigate=function(a,b){if(!__History__.started)return!1;b&&b!==!0||(b={trigger:b}),a=this.getFragment(a||""),this.fragment=a;var c=this.root+a;if(this._hasPushState)this.history[b.replace?"replaceState":"pushState"]({},document.title,c);else{if(!this._wantsHashChange)return this.location.assign(c);this._updateHash(this.location,a,b.replace),this.iframe&&a!==this.getFragment(this.getHash(this.iframe))&&(b.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,a,b.replace))}b.trigger&&this.loadUrl(a)};var __Router__=__b__.Router.extend({initialize:function(){for(var a in this.routes)__routes__.push({route:a,callback:this[this.routes[a]]})},history:function(){return __history__.slice()},route:function(a,b,c){__routes__=__routes__.filter(function(b){return b.route!=a}),__routes__.push({route:a,callback:c}),__b__.Router.prototype.route.apply(this,arguments)},routes:{},path:function(){return __staticApp__?"/"+location.hash.replace(/^#/,""):location.pathname},reload:function(){return this.navigate(this.path(),{replace:!0,trigger:!0})},navigate:function(a,b){var c=m.router;_.defer(function(){b=b||{},"trigger"in b||(b.trigger=!0),b&&b.skip__History__||(__history__.push(c.path()),__forward__History____=[]),a=a.replace(RegExp("^http://"+location.host),""),a.match(/^\//)?a.match(/^\/\//)?location=a:__b__.Router.prototype.navigate.apply(this,[a,b]):__b__.Router.prototype.navigate.apply(this,[c.path()+(c.path().match(/\/$/)?"":"/")+a,b])})},back:function(){return 0==__history__.length?(_.defer(this.navigate,"/",{replace:!0,trigger:!0,skip__History__:!0}),!1):(__forward__History____.unshift(this.path()),_.defer(this.navigate,__history__.pop(),{replace:!0,trigger:!0,skip__History__:!0}),!0)},forward:function(){return 0==__forward__History____.length?!1:(__history__.push(this.path()),_.defer(this.navigate,__forward__History____.shift(),{replace:!0,trigger:!0,skip__History__:!0}),!0)}}),toRegExp=function(a){return _.isRegExp(a)?a:__b__.Router.prototype._routeToRegExp(a)},__pendingPackages__={};m.requirePack=function(pack,callback,parentPack){function fallback(){if(fallbackPath=m.router.path(),m.packages[pack]&&m.packages[pack].loaded)packLoaded();else if(m.packageInitData[pack])packLoaded();else{var a="mpackcallback"+Date.now();m[a]=function(){_.defer(packLoaded),delete m[a]};try{$("<script src='/pack/"+pack+"?muon&lang="+m.getLanguage()+"&m_callback="+a+"'/>").appendTo(document.head)}catch(b){m.log("Package load error: "+pack+" : "+b.message),callback(!1)}}}function postProcLoadedPackage(){packObject.inited=!0;var a=m.packages[pack].packageObject;if(route){if(__b__.history.handlers=__b__.history.handlers.filter(function(a){return a.route.toString()==toRegExp(route).toString()||a.route.toString()==toRegExp(fullRoute).toString()?!1:!0}),__routes__=__routes__.filter(function(a){return a.callback==fallback?!1:!0}),addPackRoutes(pack,route,a),a.useAppView=a.useAppView||!0,a.useAppView){var b=null;b=packObject.views.stack&&m.packages[pack].views.stack.application?packObject.views.stack.application:m.ApplicationStackView.extend({"package":pack});var c=packObject.appView=new b;if(__applicationView__==c)c.$el.appendTo("body");else if(m.packages[parentPack]&&m.packages[parentPack].appView instanceof m.ApplicationStackView){var d=new m.PageLayoutView,e=c.parentAppPage="m_"+__getUniq__()+"_page";c.parentAppView=m.packages[parentPack].appView,d.el.appendChild(c.el),c.parentAppView.add(e,d)}c.addPages(a.pages||["*"])}_.defer(_.bind(__b__.history.loadUrl,__b__.history))}callback()}function initPack(){function proc_view(){if(0==views.length)return finalize();var a=views.shift();if(a.match(/^<script type='text\/javascript'/)&&"development"==__serverMode__){var b=$(a).attr("id");$("<script />").attr({src:(__staticApp__?"":"/")+"pack_view/"+__currentPackage__+"/"+b+"?muon",type:"text/javascript"}).appendTo(document.head)}else $(a).appendTo(document.head);proc_view()}function finalize(){if(__procUnhandledViews__(pack),__procProfiledViews__(pack),__currentPackage__=__prevPackage__,__currentPlugin__=__prevPlugin__,"function"==typeof mod.ready)try{mod.ready.call(mod.surrogate,postProcLoadedPackage)}catch(a){m.log("Pack load error: ready method error: "+a.stack)}else postProcLoadedPackage()}var __prevPackage__=__currentPackage__,__prevPlugin__=__currentPlugin__;__currentPackage__=pack,__currentPlugin__=pluginName;var pluginObject=__registerPlugin__(__currentPlugin__),mod=m.packageInitData[pack].package;packObject.packageObject=mod,packObject.translation=m.packageInitData[pack].translation,packObject.parentPack=m.packages[parentPack||""],mod.surrogate=mod.surrogate||{},mod.surrogate.m=__plugins__[pluginName],mod.surrogate.cfg=m.packageInitData[pack].cfg,packObject.routerPath=route,packObject.loaded=!0,packObject.m=pluginObject,pluginObject=__plugins__[""];var pluginStack=pluginName.split(":");for(var i in pluginStack){var shorterName=pack.substr(pack.indexOf(":")+1);""!=pluginStack[i]&&(pluginObject=pluginObject.plugins[pluginStack[i]]),pluginObject.packages[shorterName]=packObject}for(var i in m.packageInitData[pack].dependencies.css){var css=m.packageInitData[pack].dependencies.css[i];$("<style />").text(css).appendTo("head")}for(var i in m.packageInitData[pack].dependencies.js)eval(m.packageInitData[pack].dependencies.js[i]);for(var i in m.packageInitData[pack].models)i in m.models||eval(m.packageInitData[pack].models[i]);var views=m.packageInitData[pack].views;proc_view()}function packLoaded(){m.packages[pack]instanceof m.MuonPackage?(packObject=m.packages[pack],postProcLoadedPackage()):(m.packages[pack]=packObject=new m.MuonPackage(pack),initPack())}if(pack in __pendingPackages__)return callback&&__pendingPackages__[pack].push(callback),fallback;var fallbackPath="",pluginName=pack.substr(0,pack.lastIndexOf(":")),route,fullRoute,packObject;return callback&&(__pendingPackages__[pack]=[callback]),callback=function(a){if(__pendingPackages__[pack]instanceof Array){for(;0!=__pendingPackages__[pack].length;){if("function"==typeof __pendingPackages__[pack][0])try{__pendingPackages__[pack][0](a)}catch(b){}__pendingPackages__[pack].splice(0,1)}delete __pendingPackages__[pack]}},_.defer(function(){var a=_.where(__routes__,{callback:fallback});0!=a.length?(route=a[0].route,fullRoute=prepareRoute([route,"/*a"]),m.router.route(fullRoute,__getUniq__(),fallback)):fallback()}),fallback},m.router=new __Router__,__onReady__.push(function(){return $.browser&&$.browser.msie&&(__staticApp__=!0),__staticApp__&&!/^file/.test(location.protocol)&&location.pathname.replace(/^\//,"")?void(location.pathname="/"):("testing"==__serverMode__?window.mochaPhantomJS?mochaPhantomJS.run():mocha.run():(m.router.route("/","#{default_pack}",m.requirePack("application")),_.defer(_.bind(__b__.history.start,__b__.history),__staticApp__?{}:{pushState:!0})),void $("body").addClass("muon").delegate("a[data-route]","click",function(a){if(a.preventDefault(),!this.href){var b=this.getAttribute("data-route"),c=this.getAttribute("data-pack")||"application";if(!(c in m.packages))return;m.packages[c].routerPath&&(b=b.match(/^\/\//)?b.replace(/\/{2,}/g,"/"):b.match(/^\//)?(m.packages[c].routerPath+"/"+b).replace(/\/{2,}/g,"/"):"~"+b.replace(/\/{2,}/g,"/"),b=(__staticApp__?"#":"")+b.replace(/\^|\$/g,"")),$(this).attr("href",b).data("pack",c),console.log(b)}var d=this.href;__staticApp__&&(d=d.substring(d.indexOf("#")+1,d.length)),d=d.replace(/(^\s+)|(\s+$)/g,""),d=d.replace(this.host,"").replace(this.protocol+"//","").replace(/^\/\#/,"").replace(/^~/,""),m.router.navigate(d,{trigger:!0})}))}),__b__.Model.extend=function(a){function b(a,b){return a=a||{},"string"==typeof a._id||"number"==typeof a._id?(a._id in e?e[a._id].set(a):e[a._id]=new d(a,b),e[a._id]):new d(a,b)}var c="";c="string"==typeof a.modelName?((this.prototype.modelName?this.prototype.modelName+".":"")+a.modelName).replace(/\.+/,"."):this.prototype.modelName,a.urlRoot&&-1!=a.urlRoot.indexOf("0.0.0.0")&&(a.urlRoot=a.urlRoot.replace(/0\.0\.0\.0(:\d+)?/,__domain__&&!__domain__.match("0.0.0.0")?__domain__:location.host),__protocol__&&(a.urlRoot=a.urlRoot.replace(/^http:\/\//,__protocol__+"://")));var d=__modelBackboneExtend__.apply(this,arguments);if(d.modelName=c,a.__autoGenerated__)return d;if(_.isString(c)){var e={};b.prototype=d.prototype,b.prototype.constructor=b,_.extend(b,d),b.__objects__=e,b.modelName=c,m.models[c]=b;var f=c.substr(0,c.lastIndexOf(":")),g=__registerPlugin__(f);b.prototype.m=g,g=__plugins__[""];var h=f.split(":");for(var i in h){var j=c.substr(c.indexOf(":")+1);""!=h[i]&&(g=g.plugins[h[i]]),g.models[j]=b}return b}return d},m.Model=__b__.Model.extend({one:__b__.Model.prototype.once,idAttribute:"_id",initialize:function(a){var b=this;this.__syncName__="mod_"+Math.floor(1e4*Math.random()),this.on("change:"+this.idAttribute,function(){b.constructor.__objects__&&(delete b.constructor.__objects__[b.previousAttributes[b.idAttribute]],b.constructor.__objects__[b.id]=b)}),"function"==typeof this.init&&this.init(a)},fetch:function(a){var b=$.Deferred(),c=this;return __b__.Model.prototype.fetch.call(this,{success:function(){a&&"function"==typeof a.success&&a.success.apply(c,arguments),b.resolve(c)},error:function(){a&&"function"==typeof a.error&&a.error.apply(c,arguments),b.reject(arguments)}}),b.promise()},get:function(a){var b={value:this.attributes[a]};try{b=JSON.parse(JSON.stringify(b))}catch(c){return this.attributes[a]}return b.value},save:function(a,b){var c=$.Deferred(),d=this;return __b__.Model.prototype.save.call(this,a,{success:function(){b&&"function"==typeof b.success&&b.success.apply(d,arguments),c.resolve(d)},error:function(){b&&"function"==typeof b.error&&b.error.apply(d,arguments),c.reject(arguments)}}),c.promise()},action:function(a,b,c){var d=this;b=b||{},b.__action__=a,c=c||{};var e=c.success,f=c.error;return c.success=function(){e&&e.apply(d,arguments)},c.error=function(){f&&f.apply(d,arguments)},c.data=b,$.ajax("function"==typeof this.url?this.url():this.url,c)},destroy:function(a){var b=$.Deferred(),c=this;return __b__.Model.prototype.destroy.call(this,{success:function(){a&&"function"==typeof a.success&&a.success.apply(c,arguments),delete c.constructor.__objects__[c.id],b.resolve(c)},error:function(){a&&"error"==typeof a.error&&a.error.apply(c,arguments),b.reject(arguments)}}),b.promise()}},{get:function(a){var b=new this({_id:a});return b.fetch()},collection:function(a){return a=__serializeObject__(a||{}),a&&(a="?__action__=search&"+a),new m.Collection([],{url:this.prototype.urlRoot+a,model:this})
}}),__b__.Collection.extend=function(a){var b=_.isString(a.url)?a.url:this.prototype.url,c=__collectionBackboneExtend__.apply(this,arguments);return a.__autoGenerated__?c:(_.isString(b)&&(m.collections[b]=c),c.prototype.super=this.prototype.constructor.prototype,c)},m.Collection=__b__.Collection.extend({one:__b__.Collection.prototype.once,initialize:function(a,b){b=b||{};for(var c in b)this[c]=b[c];if("string"==typeof this.model){if(!(this.model in m.models))throw Error("Unknown model: "+this.model);this.model=m.models[this.model]}this.modelName=this.model.modelName||this.model.prototype.modelName,this.setComparator(this.comparator);var d=this;this.__syncName__="col_"+Math.floor(1e4*Math.random()),__syncNames__[this.__syncName__]=this,setTimeout(function(){for(var a in __syncNames__)__syncNames__[a]==d&&a!=d.__syncName__&&(d.keep=!0,delete __syncNames__[d.__syncName__],d.__syncName__=a)},0),"function"==typeof this.init&&this.init(arguments)},setComparator:function(a){if(this._comparator!=a){if(this._comparator=a,"string"==typeof a&&a.match(/\-\w+/)){var b=a;b=b.substr(1,b.length),this.comparator=function(a,c){return a.get(b)==c.get(b)?0:a.get(b)>c.get(b)?-1:1}}else this.comparator=a;this.sort()}},fetch:function(a){var b=$.Deferred(),c=this;return __b__.Collection.prototype.fetch.call(this,{success:function(){a&&"function"==typeof a.success&&a.success.apply(c,arguments),b.resolve(c)},error:function(){a&&"function"==typeof a.error&&a.error.apply(c,arguments),b.reject(arguments)}}),b.promise()}});var __procProjection__={collection:function(a,b,c){var d=__attrsParser__(a.getAttribute("data-context-attrs"));if("string"==typeof d.model){if(!(d.model in m.models))throw Error("Unknown model: "+d.model);d.model=m.models[d.model]}if(c instanceof m.Collection)return _.extend(c,d);var e=m.collections[b]||m.Collection,f=$.Deferred();if(_.isArray(c)){var g=new e([],d);for(var h in c){var a=c[h];("string"==typeof a||"number"==typeof a||_.isObject(a))&&g.add(new e.prototype.model(a))}return g}if(void 0===c){var g=new e([],d);return g.fetch(),g}return _.defer(f.reject,"Wrong projection type"),f.promise()},model:function(a,b,c){var d=a.getAttribute("data-context-attrs"),e=__attrsParser__(d);if(e.__autoGenerated__=!0,c instanceof m.Model)return _.extend(c,e);if(!(b in m.models||b in this.m.models))throw Error("Unknown model name: "+b);var f=m.models[b]||this.m.models[b];d&&(f=f.extend(e));var g=$.Deferred(),h=a.getAttribute("data-model-id");if(("string"==typeof c||"number"==typeof c||c)&&h)throw Error("You shouldn't use both projection variable and model Id attribute in one view simultaneously.");return"string"==typeof c||"number"==typeof c?(f.get(c).then(g.resolve,g.reject),g.promise()):"string"==typeof h?(f.get(h).then(g.resolve,g.reject),g.promise()):_.isObject(c)||void 0===c?new f:(_.defer(g.reject,"Wrong projection type"),g.promise())},layout:function(a,b,c){return _.extend(c,__attrsParser__(a.getAttribute("data-context-attrs")))},stack:function(a,b,c){return _.extend(c,__attrsParser__(a.getAttribute("data-context-attrs")))},widget:function(a,b,c){return _.extend(c,__attrsParser__(a.getAttribute("data-context-attrs")))}};__b__.View.extend=function(a){var b=_.isString(a.viewType)?a.viewType:this.prototype.viewType;a.package=a.package||__currentPackage__||this.prototype.package||__basePackage__,a.plugin=a.plugin||__currentPlugin__||this.prototype.plugin||"",a.m=__registerPlugin__(a.plugin);var c=__viewBackboneExtend__.apply(this,arguments);if(a.__autoGenerated__)return c;var d=c.prototype.template;return"string"==typeof d?(_.isObject(m.packages[__currentPackage__].views[b])||(m.packages[__currentPackage__].views[b]={}),m.packages[__currentPackage__].views[b][d]=c):(_.isArray(m.packages[__currentPackage__].viewsUnnamed[b])||(m.packages[__currentPackage__].viewsUnnamed[b]=[]),m.packages[__currentPackage__].viewsUnnamed[b].push(c)),c.prototype.super=this.prototype.constructor.prototype,c.profiles=[],b&&!m.baseViews[b]&&(m.baseViews[b]=c),c},m.View=__b__.View.extend({one:__b__.View.prototype.once,tagName:"div",toString:function(){return this.package+":"+this.viewType+":"+this.template+"["+this.cid+"]"},initialize:function(a,b){__views__[this.cid]=this,this.context=a||{},this.__inlineViews__=[],b&&b.nodeName&&(this.__forcedElement__=!0,this.el=b,this.el.muonView=this),"function"==typeof this.init&&this.init.apply(this,arguments),__render__.call(this)},__renderTemplate__:function(a){if(this.template){var b=__templateForView__(this);if(!b)return;$(a).jqoteapp(b.innerHTML,this.context)}},render:void 0,remove:function(){this.__removed__||(this.beforeRemove&&this.beforeRemove(),delete __views__[this.cid],__removeInnerViews__.call(this),this.__forcedElement__?(this.undelegateEvents(),this.$el.children().remove(),this.$el.removeAttr("data-muon")):this.$el.remove(),delete this.el.muonView,this.stopListening(),delete this.$el,delete this.el,this.__removed__=!0,this.removed&&this.removed(),this.trigger("removed"))},reload:function(){if(!this.__reload_flag__){this.__reload_flag__=!0;var a=this;_.defer(function(){a.__reload_flag__=!1,a.__unset__&&a.__unset__(),a.beforeReload&&a.beforeReload(),__removeInnerViews__.call(a),__render__.call(a),this.reloaded&&this.reloaded(),a.trigger("reloaded")})}},pack:function(){return m.packages[this.package]},surrogate:function(){return m.packages[this.package].packageObject.surrogate},trigger:function(){this.__removed__||(this.$el.trigger.apply(this.$el,arguments),__b__.View.prototype.trigger.apply(this,arguments))}}),m.ModelView=m.View.extend({viewType:"model",initialize:function(a){var b=this;this.model=a,this.listenTo(a,"change",this.__update__),this.listenTo(a,"destroy",b.remove),m.View.prototype.initialize.apply(this,arguments)},assignModelSetElement:function(a){var b=a.getAttribute("data-model-set"),c=a,d=this,e=null;d.listenTo(d.model,"sync",function(){__setGetElementValue__.call(c,d,b)}),a.getAttribute("data-silent")||d.silent||d.el.getAttribute("data-silent")||($(a).keyup(function(){clearTimeout(e),e=setTimeout(function(){$(c).trigger("change")},150)}),$(a).change(function(){this.getAttribute("data-silent")||d.silent||d.el.getAttribute("data-silent")||("function"==typeof d["set_"+b]?d["set_"+b]($(this).val(),this):d.model.set(b,$(this).val()))}))},__set__:function(){__updateModelView__.call(this,this.model.attributes);var a=this;this.$el.find("[data-model-set]").each(function(){a.assignModelSetElement(this)}),this.$el.attr("id",this.model.id)},__update__:function(){__updateModelView__.call(this,this.model.changedAttributes())},remove:function(){this.model.collection||delete __syncNames__[this.__syncName__],m.View.prototype.remove.call(this)},destroy:function(){return this.model.destroy()},save:function(){var a=this;return this.$el.find("[data-model-set]").each(function(){var b=this.getAttribute("data-model-set");"function"==typeof a["set_"+b]?a["set_"+b]($(this).val(),this):a.model.set(b,$(this).val(),{silent:!0})}),a.model.save()},fetch:function(){return this.model.fetch()}}),m.CollectionView=m.View.extend({viewType:"collection",initialize:function(a){if(this.collection=a,this.childModels={},this.modelView||(this.modelView=this.template),_.isString(this.modelView)&&(this.modelView=__getViewNameByType__("model",this.modelView,a.modelName,this.package)),!this.modelView)throw Error("ModelView for collection view is not defined: "+this.template);this.listenTo(a,"sync",__updateCollection__.bind(this)),this.listenTo(a,"add",__addToCollection__.bind(this)),this.listenTo(a,"remove",__removeFromCollection__.bind(this)),this.listenTo(a,"sort",__sorted__.bind(this)),m.View.prototype.initialize.apply(this,arguments)},remove:function(){this.collection.keep||delete __syncNames__[this.collection.__syncName__],delete this.collection,m.View.prototype.remove.call(this)},__set__:function(){this.target=this.target?this.$("#"+this.target):this.$el,this.__keepChildren__=this.target.children(),this.__keepChildrenLength__=this.__keepChildren__.length,__updateCollection__.call(this,this.collection)}}),m.WidgetView=m.View.extend({viewType:"widget"}),m.LayoutView=m.View.extend({viewType:"layout",initialize:function(a){this.blocks=a||{},m.View.prototype.initialize.apply(this,arguments)},__set__:function(){for(var a in this.blocks){var b=this.blocks[a];this.$el.find("#"+a).html(""),this.$el.find("#"+a).append(b.$el)}},__unset__:function(){for(var a in this.blocks)this.$("#"+a).html("")},get:function(a){if(a in this.blocks)return this.blocks[a];throw new Error("View is not in layout.")},removeView:function(a){a in this.blocks&&(this.$("#"+a).html(""),this.blocks[a].remove(),delete this.blocks[a])},update:function(a){var b=this.blocks||{};for(var c in a){var d=a[c];c in b&&b[c].remove(),this.blocks[c]=a[c],this.$("#"+c).html(""),this.$("#"+c).append(d.$el)}return this},remove:function(){for(var a in this.blocks)this.blocks[a]&&this.blocks[a].remove();m.View.prototype.remove.call(this)}}),m.PageLayoutView=m.LayoutView.extend({__set__:function(){this.context instanceof m.ApplicationStackView&&this.$el.append(this.context.$el),m.LayoutView.prototype.__set__.call(this)}}),m.StackView=m.View.extend({viewType:"stack",initialize:function(){this.views={},m.View.prototype.initialize.apply(this,arguments)},__set__:function(){this.$target=this.target?this.$("#"+this.target):this.$el,this.$target.addClass("");for(var a in this.views)this.$target.append(this.views[a].$el),this.current==a&&this.views[a].trigger("viewShown")},__unset__:function(){this.$target.html("")},add:function(a,b){if(a instanceof m.View&&(b=a,a=b.template),!(b instanceof m.View))throw Error(View.toString()+" is not proper View object");this.views[a]=b,this.listenTo(b,"removed",function(){delete this.views[a]}),b.$el.hide(),this.$target.append(b.$el)},removeView:function(a){a in this.views&&(this.$("#"+a).html(""),this.views[a].remove(),delete this.views[a])},remove:function(){for(var a in this.views)this.views[a]instanceof m.View&&this.views[a].remove();m.View.prototype.remove.call(this)},get:function(a){if(a in this.views)return this.views[a];throw this instanceof m.ApplicationStackView?Error("Page is not application view: "+a):new Error("View is not in this stacked view: "+a)},show:function(a){function b(){var b=e.previous;"function"==typeof e.hideAction?e.hideAction(e.views[e.previous],e.views[a],c):(e.views[b].$el.hide(),c())}function c(){var b=a;"function"==typeof e.showAction?e.showAction(e.views[e.previous],e.views[a],d):(e.views[b].$el.show(),d())}function d(){e.views[a].viewShown&&e.views[a].viewShown(),e.views[a].trigger("viewShown"),"function"==typeof e.postShow&&e.postShow()}var e=this;if(this.current!=a){if(!(a in this.views))throw Error(this instanceof m.ApplicationStackView?"Page is not in application view: "+a:"View is not in this stacked view: "+a);this.previous=e.current,this.current=a,this.beforeShow&&this.beforeShow(),void 0!=e.previous&&null!=e.previous?(e.views[a].viewHidden&&e.views[a].viewHidden(),e.views[e.previous].trigger("viewHidden"),b()):c()}}}),m.ApplicationStackView=m.StackView.extend({template:"application",__set__:function(){__applicationView__ instanceof m.ApplicationStackView||(__applicationView__=this),m.StackView.prototype.__set__.apply(this)},get:function(a){if(a+=/_page$/.test(a)?"":"_page",this.views[a]==a){var b=new(this.pack().views.layout[a]);this.views[a]=b,this.$target.append(b.$el)}return m.StackView.prototype.get.call(this,a)},show:function(a){if(a+=/_page$/.test(a)?"":"_page",this.views[a]==a){var b=new(this.pack().views.layout[a]);this.views[a]=b,this.$target.append(b.$el)}m.StackView.prototype.show.call(this,a)},add:function(a,b){if(!b&&"string"==typeof a){if(a+=/_page$/.test(a)?"":"_page",!(a in this.pack().views.layout))throw Error("Can't add not PageLayoutView instance to ApplicationStackView: "+b.template+"_"+b.viewType);return void(this.views[a]=a)}if(b||(b=a),!(b instanceof m.PageLayoutView))throw Error("Can't add not PageLayoutView instance to ApplicationStackView: "+b.template+"_"+b.viewType);b||(a=b.template),this.views[a]=b,b.$el.hide(),this.$target.append(b.$el)},addPages:function(a){var b=[],c=this.pack().views.layout;for(var d in a){var e=[],f=a[d];f=f.replace(/\-/g,"\\-"),f=f.replace(/\*/g,"[a-zA-Z0-9\\-_]*").replace(/\?/g,"[a-zA-Z0-9\\-_]").replace(/\+/g,"[a-zA-Z0-9\\-_]+"),f=f.replace(/\*/,"*?").replace(/\+/,"+?"),f=new RegExp("^"+f+"_page$");for(var g in c)-1==b.indexOf(g)&&g.match(f)&&(e.push(g),b.push(g),this.add(g))}}}),__domain__="0.0.0.0:8000",__serverMode__="development",__protocol__="http"}();